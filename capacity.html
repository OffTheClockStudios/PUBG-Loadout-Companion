<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PUBG Capacity Planner</title>
  <p><a href="index.html" class="btn">Open Weapon Loadout Page</a></p>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #151824;
      --panel-2: #1b1f2e;
      --text: #e8eaf2;
      --muted: #a9afc3;
      --accent: #7aa2ff;
      --ok: #2ecc71;
      --warn: #f1c40f;
      --bad: #e74c3c;
      --chip: #22283a;
      --line: #262b40;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";background:linear-gradient(180deg,#0d0f14,#0f1115 120px);color:var(--text)}
    header{padding:24px 20px;border-bottom:1px solid #222638;position:sticky;top:0;background:rgba(15,17,21,.7);backdrop-filter:blur(8px)}
    header h1{margin:0 0 6px;font-size:20px;letter-spacing:.3px}
    header p{margin:0;color:var(--muted);font-size:13px}

    .wrap{max-width:980px;margin:0 auto;padding:20px;display:grid;gap:16px;grid-template-columns:1.25fr .75fr}
    @media (max-width:900px){.wrap{grid-template-columns:1fr}}

    .card{background:var(--panel);border:1px solid #222638;border-radius:14px;padding:16px}
    .card h2{margin:0 0 10px;font-size:16px;font-weight:700;letter-spacing:.2px}
    .row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:12px}
    .field{display:grid;gap:6px}
    label{font-size:12px;color:var(--muted)}
    select,input[type=number]{background:var(--panel-2);color:var(--text);border:1px solid #23283a;border-radius:10px;padding:10px 12px;font-size:14px;outline:none}
    select:focus,input[type=number]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(122,162,255,.15)}

    .grid{width:100%;border-collapse:collapse}
    .grid th,.grid td{padding:10px;border-bottom:1px solid var(--line);text-align:left;font-size:14px}
    .grid th{color:var(--muted);font-weight:600}
    .grid td.num{text-align:right;font-variant-numeric:tabular-nums}

    .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip);border:1px solid #22283a;border-radius:999px;padding:8px 10px;font-size:12px;color:var(--muted)}
    .tiny{font-size:12px;color:var(--muted)}

    .actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    button{background:var(--panel-2);color:var(--text);border:1px solid #2a3148;border-radius:10px;padding:10px 12px;font-size:14px;cursor:pointer;transition:transform .05s ease,background .2s ease,border-color .2s ease}
    button:hover{background:#222842}
    button:active{transform:translateY(1px)}

    .qty{display:inline-grid;grid-template-columns:40px 64px 40px;gap:6px;align-items:center}
    .qty input{width:64px;text-align:center}
    .qty button{padding:10px;min-width:40px;min-height:40px}

    .bar{height:14px;border-radius:999px;background:#1c2235;overflow:hidden;border:1px solid #2a3148}
    .bar>span{display:block;height:100%;width:0%;transition:width .2s ease,background .2s ease}

    .summary{display:grid;gap:8px;margin-top:6px}
    .kbd{font:600 11px/1.1 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#1b2134;border:1px solid #2b3554;padding:2px 6px;border-radius:6px}
    .muted{color:var(--muted)}
    .hint{font-size:12px;color:var(--muted)}

    @media (prefers-reduced-motion:reduce){*{transition:none!important}}
    :focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  </style>
</head>
<body>
  <header>
    <h1>PUBG Capacity Planner</h1>
  </header>

  <main class="wrap">
    <!-- Left: inputs & items -->
    <section class="card">
      <h2>Loadout Inputs</h2>
      <div class="row-3">
        <div class="field">
          <label for="backpack">Backpack Level</label>
          <select id="backpack" aria-label="Backpack level"></select>
        </div>
        <div class="field">
          <label for="ammoType">Ammo Type</label>
          <select id="ammoType" aria-label="Ammo type"></select>
        </div>
        <div class="field">
          <label for="ammoQty">Preferred Ammo Quantity</label>
          <input type="number" id="ammoQty" min="0" step="1" value="180" aria-label="Preferred ammo quantity" />
        </div>
      </div>

      <div class="summary">
        <div class="chip" id="ammoChip">Ammo weight: <b id="ammoWeight">0</b></div>
        <div class="chip">Backpack capacity: <b id="cap">0</b></div>
        <div>
          <label id="capLabel" class="tiny muted">Capacity used</label>
          <div class="bar" id="usageBar" role="progressbar" aria-labelledby="capLabel" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><span id="barFill"></span></div>
          <div class="tiny" id="barText" style="margin-top:6px">0 / 0 used</div>
        </div>
      </div>

      <div class="actions">
        <button id="resetQuantities" title="Reset all item quantities">Reset quantities</button>
      </div>
    </section>

    <!-- Right: totals -->
    <aside class="card">
      <h2>Totals</h2>
      <table class="grid">
        <tbody>
          <tr><td>Ammo</td><td class="num" id="tAmmo">0</td></tr>
          <tr><td>Heals</td><td class="num" id="tHeals">0</td></tr>
          <tr><td>Boosts</td><td class="num" id="tBoosts">0</td></tr>
          <tr><td>Throwables</td><td class="num" id="tThrows">0</td></tr>
          <tr><td style="color:var(--muted)">—</td><td class="num" style="color:var(--muted)">—</td></tr>
          <tr><th>Total Used</th><th class="num" id="tUsed">0</th></tr>
          <tr><th>Remaining</th><th class="num" id="tRemain">0</th></tr>
        </tbody>
      </table>
    </aside>

    <!-- Items: Heals & Boosts -->
    <section class="card" style="grid-column:1 / -1">
      <h2>Heals & Boosts</h2>
      <table class="grid" id="itemsTableHB">
        <thead>
          <tr>
            <th scope="col" style="width:32%">Item</th>
            <th scope="col">Weight</th>
            <th scope="col">Qty</th>
            <th scope="col" class="num">Weight Total</th>
          </tr>
        </thead>
        <tbody id="itemRowsHB"></tbody>
      </table>
    </section>

    <!-- Items: Throwables -->
    <section class="card" style="grid-column:1 / -1">
      <h2>Throwables</h2>
      <table class="grid" id="itemsTableT">
        <thead>
          <tr>
            <th scope="col" style="width:32%">Item</th>
            <th scope="col">Weight</th>
            <th scope="col">Qty</th>
            <th scope="col" class="num">Weight Total</th>
          </tr>
        </thead>
        <tbody id="itemRowsT"></tbody>
      </table>
    </section>
  </main>

  <script>
    // =============================================================
    // CONFIG (edit here in index.html; no on-page settings UI)
    // =============================================================
    const CAPACITY = {
      baseDefault: 60,
      vestBonus: 50,
      includeVest: true,
      bp: { 1: 170, 2: 220, 3: 270 }
    };

    // Game data (edit as patches change)
    const AMMO = { '9mm': 0.38, '.45 ACP': 0.4, '5.56mm': 0.5, 'Flare': 0.5, '7.62mm': 0.7, '.300 Magnum': 1, '12 Gauge': 1.25, 'Bolt': 2 };
    const HEALS = { 'Bandage': 2, 'First Aid Kit': 10, 'Med Kit': 20 };
    const BOOSTS = { 'Energy Drink': 4, 'Painkiller': 10, 'Adrenaline Syringe': 20 };
    const THROWABLES = { 'Stun Grenade': 12, 'Molotov Cocktail': 16, 'Frag Grenade': 18, 'Smoke Grenade': 14 };

    // =============================================================
    // DOM
    // =============================================================
    const backpackSel = document.getElementById('backpack');
    const ammoTypeSel = document.getElementById('ammoType');
    const ammoQtyInput = document.getElementById('ammoQty');

    const ammoChip = document.getElementById('ammoChip');
    const ammoWeightEl = document.getElementById('ammoWeight');
    const capEl = document.getElementById('cap');
    const barFill = document.getElementById('barFill');
    const usageBar = document.getElementById('usageBar');
    const barText = document.getElementById('barText');

    const tAmmo = document.getElementById('tAmmo');
    const tHeals = document.getElementById('tHeals');
    const tBoosts = document.getElementById('tBoosts');
    const tThrows = document.getElementById('tThrows');
    const tUsed = document.getElementById('tUsed');
    const tRemain = document.getElementById('tRemain');

    const itemRowsHB = document.getElementById('itemRowsHB');
    const itemRowsT = document.getElementById('itemRowsT');
    const resetBtn = document.getElementById('resetQuantities');

    // =============================================================
    // Helpers & state
    // =============================================================
    const STORAGE_KEY = 'pubg_emt_planner_state_v3';
    const fmt = (n) => (Math.round(n * 100) / 100).toLocaleString();

    function totalCapacity(level){
      const base = Number(CAPACITY.baseDefault) || 0;
      const vest = CAPACITY.includeVest ? (Number(CAPACITY.vestBonus) || 0) : 0;
      const bp = Number(CAPACITY.bp[level]) || 0;
      return base + vest + bp;
    }

    function saveState(){
      const state = {
        backpack: backpackSel.value,
        ammoType: ammoTypeSel.value,
        ammoQty: ammoQtyInput.value,
        countsHB: getCounts(itemRowsHB),
        countsT: getCounts(itemRowsT)
      };
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch {}
    }
    function loadState(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch { return {}; }
    }

    function optionize(select, entries){
      select.innerHTML = '';
      for (const [name, weight] of Object.entries(entries)){
        const opt = document.createElement('option');
        opt.value = name; opt.textContent = `${name} — ${fmt(weight)}`;
        select.appendChild(opt);
      }
    }

    function updateBackpackOptions(){
      backpackSel.innerHTML = '';
      [1,2,3].forEach(l => {
        const opt = document.createElement('option');
        opt.value = String(l);
        opt.textContent = `Level ${l} — ${fmt(totalCapacity(l))}`;
        backpackSel.appendChild(opt);
      });
    }

    function makeQtyCell(key){
      const td = document.createElement('td');
      const wrap = document.createElement('div'); wrap.className = 'qty';
      const minus = document.createElement('button'); minus.textContent = '−'; minus.setAttribute('aria-label', `Decrease ${key}`);
      const input = document.createElement('input'); input.type = 'number'; input.min = '0'; input.step = '1'; input.value = '0'; input.dataset.key = key; input.setAttribute('aria-label', `${key} quantity`);
      const plus = document.createElement('button'); plus.textContent = '+'; plus.setAttribute('aria-label', `Increase ${key}`);
      wrap.append(minus, input, plus); td.appendChild(wrap);
      minus.addEventListener('click', () => { input.value = Math.max(0, parseInt(input.value||0,10)-1); recalc(); saveState(); });
      plus.addEventListener('click', () => { input.value = parseInt(input.value||0,10)+1; recalc(); saveState(); });
      input.addEventListener('input', () => { if (input.value === '') return; input.value = Math.max(0, Math.floor(Number(input.value))); recalc(); saveState(); });
      return { td, input };
    }

    function buildTable(containerEl, entries){
      containerEl.innerHTML = '';
      Object.entries(entries).forEach(([label, weight]) => {
        const tr = document.createElement('tr');
        const td1 = document.createElement('td'); td1.textContent = label; tr.appendChild(td1);
        const td2 = document.createElement('td'); td2.textContent = fmt(weight); tr.appendChild(td2);
        const { td: qtyTd } = makeQtyCell(label); tr.appendChild(qtyTd);
        const td4 = document.createElement('td'); td4.className = 'num'; td4.textContent = '0'; tr.appendChild(td4);
        tr.dataset.weight = weight; tr.dataset.key = label;
        containerEl.appendChild(tr);
      });
    }

    function getCounts(scopeEl){
      const counts = {}; [...scopeEl.querySelectorAll('input[type="number"]')].forEach(inp => counts[inp.dataset.key] = Number(inp.value||0));
      return counts;
    }
    function setCounts(scopeEl, map){
      [...scopeEl.querySelectorAll('input[type="number"]')].forEach(inp => { const k = inp.dataset.key; inp.value = Math.max(0, Math.floor(map?.[k]||0)); });
    }

    function recalc(){
      // capacity
      const cap = totalCapacity(Number(backpackSel.value));
      capEl.textContent = fmt(cap);

      // ammo
      const ammoType = ammoTypeSel.value;
      const ammoQty = Math.max(0, Math.floor(Number(ammoQtyInput.value||0)));
      const ammoW = (AMMO[ammoType]||0) * ammoQty; ammoWeightEl.textContent = fmt(ammoW);
      ammoChip.innerHTML = `Ammo (<span class="kbd">${ammoType}</span> × ${ammoQty}) weight: <b>${fmt(ammoW)}</b>`;

      // items: heals & boosts
      let healsW = 0, boostsW = 0;
      [...itemRowsHB.querySelectorAll('tr')].forEach(tr => {
        const key = tr.dataset.key; const wt = Number(tr.dataset.weight);
        const qty = Math.max(0, Math.floor(Number(tr.querySelector('input').value||0)));
        const cell = tr.querySelector('td.num'); const total = qty * wt; cell.textContent = fmt(total);
        if (HEALS[key] !== undefined) healsW += total; else if (BOOSTS[key] !== undefined) boostsW += total;
      });

      // items: throwables
      let throwsW = 0;
      [...itemRowsT.querySelectorAll('tr')].forEach(tr => {
        const wt = Number(tr.dataset.weight);
        const qty = Math.max(0, Math.floor(Number(tr.querySelector('input').value||0)));
        const cell = tr.querySelector('td.num'); const total = qty * wt; cell.textContent = fmt(total);
        throwsW += total;
      });

      // totals & bar
      const used = ammoW + healsW + boostsW + throwsW;
      const remain = cap - used;
      tAmmo.textContent = fmt(ammoW); tHeals.textContent = fmt(healsW); tBoosts.textContent = fmt(boostsW); tThrows.textContent = fmt(throwsW);
      tUsed.textContent = fmt(used); tRemain.textContent = fmt(remain);

      const pct = cap > 0 ? Math.max(0, Math.min(100, (used/cap)*100)) : 0;
      barFill.style.width = pct + '%';
      barFill.style.background = (cap <= 0 || used > cap) ? 'var(--bad)' : (pct > 85 ? 'var(--warn)' : 'var(--ok)');
      usageBar.setAttribute('aria-valuenow', String(Math.round(pct)));
      barText.textContent = `${fmt(used)} / ${fmt(cap)} used (${cap>0?Math.round(pct)+'%':'—'})`;
    }

    // =============================================================
    // Init
    // =============================================================
    (function init(){
      updateBackpackOptions();
      optionize(ammoTypeSel, AMMO); ammoTypeSel.value = '5.56mm';
      buildTable(itemRowsHB, { ...HEALS, ...BOOSTS });
      buildTable(itemRowsT, THROWABLES);

      const saved = loadState();
      if (saved.backpack) backpackSel.value = saved.backpack;
      if (saved.ammoType) ammoTypeSel.value = saved.ammoType;
      if (saved.ammoQty) ammoQtyInput.value = saved.ammoQty;
      if (saved.countsHB) setCounts(itemRowsHB, saved.countsHB);
      if (saved.countsT) setCounts(itemRowsT, saved.countsT);

      recalc();

      // listeners
      backpackSel.addEventListener('change', () => { recalc(); saveState(); });
      ammoTypeSel.addEventListener('change', () => { recalc(); saveState(); });
      ammoQtyInput.addEventListener('input', () => { recalc(); saveState(); });
      resetBtn.addEventListener('click', () => {
        setCounts(itemRowsHB, {});
        setCounts(itemRowsT, {});
        recalc();
        saveState();
      });
    })();
  </script>
</body>
</html>
